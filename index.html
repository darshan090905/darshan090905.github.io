<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Darshan Patgar | DevOps Engineer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
<!-- EmailJS ‚Äî sends contact form directly to your email inbox -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
:root {
  --bg:#0a0f1a; --surface:#111827; --surface2:#1a2235;
  --border:#1e2d45; --border2:#243352;
  --accent:#38bdf8; --accent-dim:rgba(56,189,248,0.12);
  --green:#4ade80; --green-dim:rgba(74,222,128,0.1);
  --purple:#a78bfa; --orange:#fb923c;
  --text:#f0f6ff; --muted:#64748b; --muted2:#94a3b8; --red:#f87171;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;scroll-padding-top:70px;}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;overflow-x:hidden;line-height:1.6;}
a{text-decoration:none;} button{cursor:pointer;font-family:'Inter',sans-serif;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:50;height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 2rem;background:rgba(10,15,26,0.95);border-bottom:1px solid var(--border);backdrop-filter:blur(16px);}
.nav-brand{font-family:'JetBrains Mono',monospace;font-size:0.85rem;font-weight:700;color:var(--accent);display:flex;align-items:center;gap:0.5rem;}
.nav-dot{width:7px;height:7px;background:var(--green);border-radius:50%;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.8)}}
.nav-links{display:flex;gap:0.25rem;list-style:none;}
.nav-links a{color:var(--muted2);font-size:0.82rem;padding:0.4rem 0.9rem;border-radius:6px;transition:all 0.2s;}
.nav-links a:hover{background:var(--surface2);color:var(--text);}
.nav-admin-btn{background:var(--surface2);border:1px solid var(--border2);color:var(--muted2);font-size:0.75rem;padding:0.4rem 1rem;border-radius:6px;transition:all 0.2s;display:flex;align-items:center;gap:0.4rem;}
.nav-admin-btn:hover{border-color:var(--accent);color:var(--accent);}
@media(max-width:700px){.nav-links{display:none;}}

/* HERO */
#hero{min-height:100vh;padding:100px 6vw 60px;display:grid;grid-template-columns:1fr 420px;gap:3rem;align-items:center;position:relative;overflow:hidden;}
@media(max-width:900px){#hero{grid-template-columns:1fr;padding-top:90px;}}
.hero-bg-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(56,189,248,0.035) 1px,transparent 1px),linear-gradient(90deg,rgba(56,189,248,0.035) 1px,transparent 1px);background-size:50px 50px;pointer-events:none;}
.hero-glow{position:absolute;width:500px;height:500px;background:radial-gradient(circle,rgba(56,189,248,0.08) 0%,transparent 65%);top:-80px;right:100px;pointer-events:none;}
.hero-glow2{position:absolute;width:350px;height:350px;background:radial-gradient(circle,rgba(167,139,250,0.07) 0%,transparent 65%);bottom:0;left:0;pointer-events:none;}
.hero-left{position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:0.5rem;background:var(--green-dim);border:1px solid rgba(74,222,128,0.25);color:var(--green);font-size:0.72rem;font-weight:500;padding:0.35rem 0.9rem;border-radius:100px;margin-bottom:1.8rem;}
.hero-name{font-size:clamp(2.8rem,5.5vw,5rem);font-weight:700;line-height:1.1;letter-spacing:-0.03em;margin-bottom:0.5rem;}
.hero-name .last{color:var(--accent);}
.hero-title{font-family:'JetBrains Mono',monospace;font-size:0.82rem;color:var(--muted2);margin-bottom:1.5rem;display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;}
.hero-title .sep{color:var(--border2);}
.hero-desc{font-size:0.95rem;color:var(--muted2);line-height:1.75;max-width:520px;margin-bottom:2.5rem;}
.hero-btns{display:flex;gap:0.75rem;flex-wrap:wrap;}
.btn-fill{background:var(--accent);color:#0a0f1a;font-size:0.82rem;font-weight:600;padding:0.7rem 1.6rem;border-radius:8px;border:none;transition:all 0.2s;display:inline-flex;align-items:center;gap:0.5rem;}
.btn-fill:hover{background:#7dd3fc;transform:translateY(-1px);box-shadow:0 6px 24px rgba(56,189,248,0.25);}
.btn-ghost{background:transparent;color:var(--text);font-size:0.82rem;padding:0.7rem 1.6rem;border-radius:8px;border:1px solid var(--border2);transition:all 0.2s;display:inline-flex;align-items:center;gap:0.5rem;}
.btn-ghost:hover{border-color:var(--accent);color:var(--accent);}

/* Terminal */
.hero-right{position:relative;z-index:1;}
@media(max-width:900px){.hero-right{display:none;}}
.terminal{background:var(--surface);border:1px solid var(--border2);border-radius:12px;overflow:hidden;box-shadow:0 24px 60px rgba(0,0,0,0.5);}
.terminal-header{background:var(--surface2);padding:0.75rem 1.1rem;display:flex;align-items:center;gap:0.5rem;border-bottom:1px solid var(--border);}
.t-btn{width:11px;height:11px;border-radius:50%;}
.t-btn.r{background:#ff5f57;}.t-btn.y{background:#febc2e;}.t-btn.g{background:#28c840;}
.t-label{margin-left:0.5rem;font-family:'JetBrains Mono',monospace;font-size:0.68rem;color:var(--muted);}
.terminal-body{padding:1.2rem 1.4rem;font-family:'JetBrains Mono',monospace;font-size:0.72rem;line-height:1.9;}
.t-prompt{color:var(--accent);}.t-cmd{color:var(--text);}.t-ok{color:var(--green);}.t-warn{color:var(--orange);}.t-comment{color:var(--muted);}
.t-cursor{display:inline-block;width:6px;height:13px;background:var(--accent);vertical-align:middle;animation:blink 1s step-end infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

/* Stats */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:0;margin-top:3.5rem;border:1px solid var(--border);border-radius:12px;overflow:hidden;}
.stat-box{padding:1.4rem 1rem;text-align:center;border-right:1px solid var(--border);position:relative;overflow:hidden;}
.stat-box:last-child{border-right:none;}
.stat-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--purple));transform:scaleX(0);transition:transform 0.4s;}
.stat-box:hover::before{transform:scaleX(1);}
.stat-val{font-size:1.9rem;font-weight:700;color:var(--accent);line-height:1;margin-bottom:0.3rem;}
.stat-key{font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.08em;font-weight:500;}
@media(max-width:600px){.stats-row{grid-template-columns:1fr 1fr;}.stat-box{border-bottom:1px solid var(--border);}}

/* SECTIONS */
.section{padding:5rem 6vw;}
.section-alt{background:var(--surface);}
.sec-label{display:flex;align-items:center;gap:0.75rem;margin-bottom:2.5rem;}
.sec-num{font-family:'JetBrains Mono',monospace;font-size:0.72rem;color:var(--accent);}
.sec-title{font-size:1.8rem;font-weight:700;letter-spacing:-0.02em;}
.sec-line{flex:1;height:1px;background:var(--border);max-width:120px;}

/* Skills */
.skills-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:1rem;}
.skill-card{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:1.3rem;transition:all 0.25s;}
.skill-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 30px rgba(56,189,248,0.06);}
.sk-cat{font-size:0.68rem;font-weight:600;color:var(--accent);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.9rem;}
.sk-tags{display:flex;flex-wrap:wrap;gap:0.4rem;}
.sk-tag{font-size:0.72rem;padding:0.25rem 0.65rem;background:var(--surface2);border:1px solid var(--border2);border-radius:5px;color:var(--muted2);transition:all 0.2s;}
.sk-tag:hover{background:var(--accent-dim);border-color:var(--accent);color:var(--accent);}

/* Projects */
.projects-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.2rem;}
.proj-card{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:1.8rem;transition:all 0.25s;position:relative;overflow:hidden;}
.proj-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--purple));transform:scaleX(0);transition:transform 0.3s;transform-origin:left;}
.proj-card:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,0,0,0.3);}
.proj-card:hover::after{transform:scaleX(1);}
.proj-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1rem;}
.proj-icon{width:40px;height:40px;border-radius:8px;background:var(--accent-dim);border:1px solid rgba(56,189,248,0.2);display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
.proj-num{font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:var(--muted);}
.proj-title{font-size:1rem;font-weight:600;margin-bottom:0.6rem;line-height:1.35;}
.proj-desc{font-size:0.8rem;color:var(--muted2);line-height:1.7;margin-bottom:1.2rem;}
.proj-tags{display:flex;flex-wrap:wrap;gap:0.35rem;}
.proj-tag{font-size:0.65rem;padding:0.2rem 0.55rem;background:rgba(167,139,250,0.1);border:1px solid rgba(167,139,250,0.25);color:var(--purple);border-radius:4px;}

/* Certs */
.cert-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:0.7rem;}
.cert-card{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:0.8rem 0.85rem;display:flex;align-items:flex-start;gap:0.65rem;transition:all 0.2s;position:relative;cursor:pointer;min-height:110px;}
.cert-card:hover{border-color:var(--border2);box-shadow:0 4px 20px rgba(0,0,0,0.2);}
.cert-main{flex:1;min-width:0;}
.cert-ico{width:34px;height:34px;border-radius:8px;background:rgba(251,146,60,0.1);border:1px solid rgba(251,146,60,0.25);display:flex;align-items:center;justify-content:center;font-size:0.9rem;flex-shrink:0;}
.cert-ico.blue{background:var(--accent-dim);border-color:rgba(56,189,248,0.25);}
.cert-ico.green{background:var(--green-dim);border-color:rgba(74,222,128,0.25);}
.cert-ico.pending{background:rgba(100,116,139,0.1);border-color:var(--border2);}
.cert-name{font-size:0.73rem;font-weight:600;line-height:1.28;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.cert-by{font-size:0.64rem;color:var(--muted);margin-top:0.1rem;}
.cert-status{font-size:0.6rem;color:var(--orange);margin-top:0.12rem;display:flex;align-items:center;gap:0.25rem;}
.cert-actions{display:flex;align-items:center;gap:0.35rem;flex-wrap:wrap;margin-top:0.32rem;}
.cert-del{position:absolute;top:0.45rem;right:0.45rem;background:none;border:none;color:var(--muted);font-size:0.9rem;opacity:0;pointer-events:none;transition:opacity 0.2s;}
.cert-del:hover{color:var(--red);}
.cert-file-tag{font-size:0.58rem;color:var(--accent);margin-top:0.1rem;}
.cert-cred-btn{display:inline-flex;align-items:center;gap:0.25rem;font-size:0.6rem;color:var(--text);background:var(--surface2);border:1px solid var(--border2);padding:0.16rem 0.48rem;border-radius:999px;text-decoration:none;transition:all 0.2s;line-height:1.1;}
.cert-cred-btn:hover{border-color:var(--accent);color:var(--accent);}

/* Contact */
.contact-wrap{display:grid;grid-template-columns:1fr 1fr;gap:3rem;}
@media(max-width:768px){.contact-wrap{grid-template-columns:1fr;}}
.contact-info h3{font-size:1.5rem;font-weight:700;margin-bottom:0.8rem;}
.contact-info p{font-size:0.85rem;color:var(--muted2);line-height:1.75;margin-bottom:1.8rem;}
.contact-links{display:flex;flex-direction:column;gap:0.6rem;}
.c-link{display:flex;align-items:center;gap:0.8rem;padding:0.75rem 1rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;transition:all 0.2s;}
.c-link:hover{border-color:var(--accent);color:var(--accent);}
.c-ico{width:28px;height:28px;background:var(--surface2);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.9rem;flex-shrink:0;}
.c-lbl{font-size:0.62rem;color:var(--muted);display:block;margin-bottom:0.1rem;}
.contact-form{display:flex;flex-direction:column;gap:0.9rem;}
.f-group{display:flex;flex-direction:column;gap:0.35rem;}
.f-label{font-size:0.7rem;color:var(--muted2);font-weight:500;letter-spacing:0.05em;}
.f-input,.f-textarea{background:var(--surface2);border:1px solid var(--border2);color:var(--text);padding:0.7rem 1rem;font-family:'Inter',sans-serif;font-size:0.82rem;border-radius:8px;outline:none;transition:border-color 0.2s;}
.f-input:focus,.f-textarea:focus{border-color:var(--accent);}
.f-textarea{min-height:110px;resize:vertical;}
.send-btn{position:relative;overflow:hidden;}
.send-btn .btn-spinner{display:none;width:14px;height:14px;border:2px solid rgba(10,15,26,0.3);border-top-color:#0a0f1a;border-radius:50%;animation:spin 0.6s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}

/* Footer */
footer{padding:1.8rem 6vw;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;}
footer span{font-size:0.75rem;color:var(--muted);}
footer .f-right{color:var(--accent);font-family:'JetBrains Mono',monospace;font-size:0.72rem;}

/* Toast */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;background:var(--surface2);border:1px solid var(--accent);color:var(--text);padding:0.75rem 1.2rem;font-size:0.78rem;border-radius:8px;transform:translateY(80px);transition:transform 0.3s;box-shadow:0 8px 30px rgba(0,0,0,0.4);display:flex;align-items:center;gap:0.5rem;max-width:320px;}
.toast.show{transform:translateY(0);}
.toast.error{border-color:var(--red);}
.toast.success{border-color:var(--green);}

/* OVERLAY base */
.overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.75);backdrop-filter:blur(12px);align-items:center;justify-content:center;overflow-y:auto;padding:1rem 0;}
.overlay.active{display:flex;}

/* LOGIN CARD */
.login-card{background:var(--surface);border:1px solid var(--border2);border-radius:16px;padding:2.5rem;width:min(90vw,400px);box-shadow:0 30px 80px rgba(0,0,0,0.6);position:relative;margin:auto;max-height:calc(100vh - 2rem);overflow-y:auto;}
@media(max-width:768px){.login-card{padding:1.8rem;width:min(95vw,400px);}}
.lc-header{text-align:center;margin-bottom:2rem;}
.lc-icon{font-size:2rem;margin-bottom:0.75rem;}
.lc-header h2{font-size:1.3rem;font-weight:700;margin-bottom:0.3rem;}
.lc-header p{font-size:0.78rem;color:var(--muted);}
.login-form{display:flex;flex-direction:column;gap:1rem;}
.lc-close{position:absolute;top:1rem;right:1rem;background:none;border:1px solid var(--border);color:var(--muted);width:32px;height:32px;border-radius:6px;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.lc-close:hover{border-color:var(--red);color:var(--red);}

/* ADMIN PANEL */
.admin-panel{display:none;position:fixed;inset:0;z-index:300;background:var(--bg);overflow-y:auto;}
.admin-panel.active{display:block;}
.admin-header{position:sticky;top:0;z-index:10;background:rgba(10,15,26,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.admin-header h2{font-size:1rem;font-weight:600;display:flex;align-items:center;gap:0.5rem;}
.admin-badge{font-size:0.62rem;background:var(--accent-dim);border:1px solid rgba(56,189,248,0.3);color:var(--accent);padding:0.2rem 0.6rem;border-radius:100px;}
.admin-close{background:none;border:1px solid var(--border2);color:var(--muted2);padding:0.4rem 1rem;border-radius:6px;font-size:0.75rem;transition:all 0.2s;display:flex;align-items:center;gap:0.4rem;}
.admin-close:hover{border-color:var(--red);color:var(--red);}
.admin-body{padding:2rem;max-width:960px;margin:0 auto;display:flex;flex-direction:column;gap:2rem;}
.admin-section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.8rem;}
.admin-section h3{font-size:1rem;font-weight:600;margin-bottom:1.5rem;display:flex;align-items:center;gap:0.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border);}
.admin-form{display:flex;flex-direction:column;gap:0.9rem;}
.admin-row{display:grid;grid-template-columns:1fr 1fr;gap:0.9rem;}
@media(max-width:600px){.admin-row{grid-template-columns:1fr;}}
.a-label{font-size:0.7rem;color:var(--muted2);font-weight:500;display:block;margin-bottom:0.35rem;}
.a-input,.a-textarea,.a-select{width:100%;background:var(--bg);border:1px solid var(--border2);color:var(--text);padding:0.65rem 0.9rem;font-family:'Inter',sans-serif;font-size:0.82rem;border-radius:8px;outline:none;transition:border-color 0.2s;}
.a-input:focus,.a-textarea:focus,.a-select:focus{border-color:var(--accent);}
.a-textarea{min-height:80px;resize:vertical;}
.a-select option{background:var(--surface);}
.admin-add-btn{background:var(--accent);color:var(--bg);font-size:0.8rem;font-weight:600;padding:0.65rem 1.4rem;border:none;border-radius:8px;transition:all 0.2s;display:inline-flex;align-items:center;gap:0.4rem;align-self:flex-start;}
.admin-add-btn:hover{background:#7dd3fc;transform:translateY(-1px);}
.tags-preview{display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;}
.admin-tag-pill{font-size:0.65rem;padding:0.2rem 0.5rem;background:var(--accent-dim);border:1px solid rgba(56,189,248,0.3);color:var(--accent);border-radius:4px;}
.admin-list{display:flex;flex-direction:column;gap:0.6rem;margin-top:1rem;}
.admin-item{display:flex;align-items:center;justify-content:space-between;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:0.8rem 1rem;font-size:0.8rem;gap:0.5rem;}
.ai-name{font-weight:500;flex:1;}
.ai-type{font-size:0.68rem;color:var(--muted);}
.ai-del{background:none;border:none;color:var(--muted);font-size:0.9rem;transition:color 0.2s;flex-shrink:0;}
.ai-del:hover{color:var(--red);}
.empty-note{font-size:0.75rem;color:var(--muted);padding:0.5rem 0;}

/* INBOX in admin */
.inbox-list{display:flex;flex-direction:column;gap:0.75rem;margin-top:0.5rem;}
.inbox-msg{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:1rem 1.2rem;position:relative;}
.inbox-msg.unread{border-left:3px solid var(--accent);}
.inbox-meta{display:flex;align-items:center;gap:1rem;margin-bottom:0.5rem;flex-wrap:wrap;}
.inbox-from{font-size:0.8rem;font-weight:600;}
.inbox-email{font-size:0.72rem;color:var(--accent);}
.inbox-time{font-size:0.65rem;color:var(--muted);margin-left:auto;}
.inbox-text{font-size:0.78rem;color:var(--muted2);line-height:1.6;}
.inbox-del{position:absolute;top:0.8rem;right:0.8rem;background:none;border:none;color:var(--muted);font-size:0.85rem;cursor:pointer;opacity:0;transition:opacity 0.2s;}
.inbox-msg:hover .inbox-del{opacity:1;}
.inbox-del:hover{color:var(--red);}
.inbox-badge{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;background:var(--red);color:#fff;font-size:0.6rem;font-weight:700;border-radius:100px;padding:0 4px;margin-left:0.4rem;}

/* PDF Modal */
.pdf-modal{display:none;position:fixed;inset:0;z-index:400;background:rgba(0,0,0,0.85);backdrop-filter:blur(10px);align-items:center;justify-content:center;}
.pdf-modal.active{display:flex;}
.pdf-box{background:var(--surface);border:1px solid var(--border2);border-radius:12px;width:min(92vw,780px);height:min(88vh,680px);display:flex;flex-direction:column;overflow:hidden;}
.pdf-top{padding:0.9rem 1.3rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.pdf-top span{font-size:0.8rem;color:var(--accent);font-family:'JetBrains Mono',monospace;}
.pdf-top button{background:none;border:1px solid var(--border2);color:var(--muted2);padding:0.3rem 0.8rem;border-radius:6px;font-size:0.72rem;transition:all 0.2s;}
.pdf-top button:hover{border-color:var(--red);color:var(--red);}
.pdf-frame{flex:1;border:none;width:100%;}


/* Cert image preview */
.cert-img-wrap{width:100%;height:140px;overflow:hidden;border-radius:8px 8px 0 0;margin:-1.1rem -1.3rem 0.9rem;width:calc(100% + 2.6rem);}
.cert-img-wrap img{width:100%;height:140px;object-fit:cover;display:block;transition:transform 0.3s;}
.cert-card:hover .cert-img-wrap img{transform:scale(1.04);}
.cert-card.has-img{flex-direction:column;align-items:flex-start;padding-top:0;}
.cert-card.has-img .cert-ico{display:none;}
/* Github link on project card */
.proj-gh-link{display:inline-flex;align-items:center;gap:0.35rem;margin-top:1rem;font-size:0.72rem;color:var(--muted2);border:1px solid var(--border2);padding:0.3rem 0.75rem;border-radius:6px;text-decoration:none;transition:all 0.2s;background:var(--surface2);}
.proj-gh-link:hover{border-color:var(--accent);color:var(--accent);}
.proj-gh-link svg{width:13px;height:13px;fill:currentColor;}


/* Edit modal */
.edit-modal{display:none;position:fixed;inset:0;z-index:500;background:rgba(0,0,0,0.8);backdrop-filter:blur(12px);align-items:center;justify-content:center;}
.edit-modal.active{display:flex;}
.edit-box{background:var(--surface);border:1px solid var(--border2);border-radius:14px;width:min(92vw,600px);max-height:90vh;overflow-y:auto;padding:2rem;position:relative;}
.edit-box h3{font-size:1rem;font-weight:700;margin-bottom:1.5rem;padding-bottom:0.8rem;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:0.5rem;}
.edit-close{position:absolute;top:1rem;right:1rem;background:none;border:1px solid var(--border2);color:var(--muted2);width:30px;height:30px;border-radius:6px;font-size:0.9rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.edit-close:hover{border-color:var(--red);color:var(--red);}
.edit-form{display:flex;flex-direction:column;gap:0.9rem;}
.edit-row{display:grid;grid-template-columns:1fr 1fr;gap:0.9rem;}
@media(max-width:540px){.edit-row{grid-template-columns:1fr;}}
.edit-actions{display:flex;gap:0.7rem;margin-top:0.5rem;}
.btn-save{background:var(--accent);color:var(--bg);font-size:0.8rem;font-weight:600;padding:0.6rem 1.3rem;border:none;border-radius:8px;transition:all 0.2s;}
.btn-save:hover{background:#7dd3fc;}
.btn-cancel-edit{background:none;border:1px solid var(--border2);color:var(--muted2);font-size:0.8rem;padding:0.6rem 1.1rem;border-radius:8px;transition:all 0.2s;}
.btn-cancel-edit:hover{border-color:var(--red);color:var(--red);}
/* Edit/delete buttons in admin list */
.ai-actions{display:flex;gap:0.4rem;flex-shrink:0;}
.ai-edit{background:none;border:1px solid var(--border2);color:var(--muted2);font-size:0.72rem;padding:0.25rem 0.6rem;border-radius:5px;transition:all 0.2s;}
.ai-edit:hover{border-color:var(--accent);color:var(--accent);}

/* Reveal */
.reveal{opacity:0;transform:translateY(24px);transition:opacity 0.5s ease,transform 0.5s ease;}
.reveal.in{opacity:1;transform:none;}

/* EmailJS setup notice */
.setup-notice{background:rgba(251,146,60,0.08);border:1px solid rgba(251,146,60,0.25);border-radius:8px;padding:1rem 1.2rem;font-size:0.78rem;color:var(--orange);line-height:1.6;margin-bottom:1rem;}
.setup-notice strong{color:#fdba74;}
.setup-notice a{color:var(--accent);text-decoration:underline;}
</style>
</head>
<body>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- PDF Modal -->
<div class="pdf-modal" id="pdfModal">
  <div class="pdf-box">
    <div class="pdf-top">
      <span id="pdfLabel">Certificate</span>
      <button onclick="closePdf()">‚úï Close</button>
    </div>
    <iframe class="pdf-frame" id="pdfFrame"></iframe>
    <img id="certImgView" style="display:none;flex:1;width:100%;object-fit:contain;background:#000;padding:1rem;" alt="Certificate">
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê ADMIN LOGIN ‚ïê‚ïê‚ïê -->
<div class="overlay" id="loginOverlay">
  <div class="login-card">
    <button class="lc-close" onclick="closeLogin()">‚úï</button>
    <div class="lc-header">
      <div class="lc-icon">üîê</div>
      <h2>Admin Login</h2>
      <p>Only Darshan can manage content</p>
    </div>
    <form class="login-form" id="loginForm" onsubmit="doLogin(event)">
      <div class="f-group">
        <label class="f-label">Username</label>
        <input class="f-input" type="text" id="loginUser" placeholder="Username" autocomplete="username" spellcheck="false" required>
      </div>
      <div class="f-group">
        <label class="f-label">Password</label>
        <input class="f-input" type="password" id="loginPass" placeholder="Password" autocomplete="current-password" required>
      </div>
      <button type="submit" class="btn-fill" style="width:100%;justify-content:center;" id="loginBtn">‚Üí Sign In</button>
      <p id="loginHint" style="font-size:0.68rem;color:var(--red);text-align:center;display:none;">
        Too many failed attempts. Please try again later.
      </p>
    </form>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <h2>‚öô Admin Panel <span class="admin-badge">Darshan Patgar</span></h2>
    <button class="admin-close" onclick="closeAdmin()">‚úï Exit Panel</button>
  </div>
  <div class="admin-body">

    <!-- ‚îÄ INBOX ‚îÄ -->
    <div class="admin-section">
      <h3>üì• Contact Inbox <span id="inboxBadge" class="inbox-badge" style="display:none;"></span></h3>
      <p style="font-size:0.78rem;color:var(--muted2);margin-bottom:1rem;">Messages submitted through the contact form appear here instantly. They are also sent to your email via EmailJS.</p>
      <div class="inbox-list" id="inboxList">
        <p class="empty-note">No messages yet. Messages from visitors will appear here.</p>
      </div>
    </div>

    <!-- ‚îÄ ADD PROJECT ‚îÄ -->
    <div class="admin-section">
      <h3>üìÅ Add New Project</h3>
      <div class="admin-form">
        <div class="admin-row">
          <div>
            <label class="a-label">Project Title *</label>
            <input class="a-input" id="pTitle" placeholder="e.g. Kubernetes Monitoring Stack">
          </div>
          <div>
            <label class="a-label">Icon (emoji)</label>
            <input class="a-input" id="pIcon" placeholder="üîß" maxlength="4" value="üîß">
          </div>
        </div>
        <div>
          <label class="a-label">Description *</label>
          <textarea class="a-textarea" id="pDesc" placeholder="Describe what this project does and the problem it solves..."></textarea>
        </div>
        <div>
          <label class="a-label">Tech Stack (comma separated)</label>
          <input class="a-input" id="pTech" placeholder="Jenkins, Docker, Kubernetes, AWS">
          <div class="tags-preview" id="pTechPreview"></div>
        </div>
        <div>
          <label class="a-label">GitHub Repository URL (optional)</label>
          <input class="a-input" id="pGithub" placeholder="https://github.com/darshan090905/project-name">
        </div>
        <button class="admin-add-btn" onclick="addProject()">+ Add Project</button>
      </div>
      <div class="admin-list" id="adminProjList"></div>
    </div>

    <!-- ‚îÄ ADD CERTIFICATE ‚îÄ -->
    <div class="admin-section">
      <h3>üèÖ Add Certificate</h3>
      <div class="admin-form">
        <div class="admin-row">
          <div>
            <label class="a-label">Certificate Name *</label>
            <input class="a-input" id="cName" placeholder="e.g. AWS Solutions Architect">
          </div>
          <div>
            <label class="a-label">Issuing Organization *</label>
            <input class="a-input" id="cIssuer" placeholder="e.g. Amazon Web Services">
          </div>
        </div>
        <div class="admin-row">
          <div>
            <label class="a-label">Status</label>
            <select class="a-select" id="cStatus">
              <option value="earned">‚úÖ Earned</option>
              <option value="progress">‚è≥ In Progress</option>
            </select>
          </div>
          <div>
            <label class="a-label">Credential URL (optional)</label>
            <input class="a-input" id="cCred" placeholder="https://www.credly.com/badges/...">
          </div>
        </div>
        <div class="admin-row">
          <div style="grid-column:1 / -1;">
            <label class="a-label">Upload Certificate (PDF / Image)</label>
            <input type="file" id="certFileAdmin" accept=".pdf,.png,.jpg,.jpeg" onchange="onCertFile(this)">
            <button class="admin-add-btn" style="margin-top:0.5rem;padding:0.4rem 1rem;font-size:0.72rem;" onclick="document.getElementById('certFileAdmin').click()">üìé Browse File</button>
            <span id="certFileName" style="font-size:0.68rem;color:var(--green);margin-left:0.4rem;display:block;margin-top:0.3rem;"></span>
            <p style="font-size:0.65rem;color:var(--muted);margin-top:0.3rem;">Images (PNG/JPG) show as thumbnail on the card. PDFs open in viewer.</p>
          </div>
        </div>
        <button class="admin-add-btn" onclick="addCert()">+ Add Certificate</button>
      </div>
      <div class="admin-list" id="adminCertList"></div>
    </div>

    <!-- ‚îÄ MANAGE SKILLS ‚îÄ -->
    <div class="admin-section">
      <h3>üõ† Manage Technical Skills</h3>
      <div class="admin-form">
        <div class="admin-row">
          <div>
            <label class="a-label">Icon (emoji)</label>
            <input class="a-input" id="sIcon" placeholder="‚òÅ" maxlength="4" value="‚òÅ">
          </div>
          <div>
            <label class="a-label">Category Name *</label>
            <input class="a-input" id="sCategory" placeholder="e.g. Cloud & Infrastructure">
          </div>
        </div>
        <div>
          <label class="a-label">Skills/Tools (comma separated) *</label>
          <input class="a-input" id="sTags" placeholder="AWS EC2, AWS VPC, IAM, Terraform">
          <div class="tags-preview" id="sTagsPreview"></div>
        </div>
        <button class="admin-add-btn" onclick="addSkill()">+ Add Skill Category</button>
      </div>
      <div class="admin-list" id="adminSkillList"></div>
    </div>

    <!-- ‚îÄ EMAIL SETUP ‚îÄ -->
    <div class="admin-section">
      <h3>üìß Email Notifications Setup</h3>
      <div class="setup-notice">
        <strong>One-time setup to receive contact form emails:</strong><br>
        1. Go to <a href="https://www.emailjs.com" target="_blank">emailjs.com</a> ‚Üí Sign up free<br>
        2. Add an Email Service (Gmail) ‚Üí copy your <strong>Service ID</strong><br>
        3. Create a Template with variables: <code>{{from_name}}</code>, <code>{{from_email}}</code>, <code>{{message}}</code> ‚Üí copy <strong>Template ID</strong><br>
        4. Go to Account ‚Üí copy your <strong>Public Key</strong><br>
        5. Paste all three below and save.
      </div>
      <div class="admin-form">
        <div class="admin-row">
          <div>
            <label class="a-label">EmailJS Service ID</label>
            <input class="a-input" id="ejs_sid" placeholder="service_xxxxxxx">
          </div>
          <div>
            <label class="a-label">EmailJS Template ID</label>
            <input class="a-input" id="ejs_tid" placeholder="template_xxxxxxx">
          </div>
        </div>
        <div>
          <label class="a-label">EmailJS Public Key</label>
          <input class="a-input" id="ejs_pk" placeholder="your_public_key_here">
        </div>
        <button class="admin-add-btn" onclick="saveEmailConfig()">üíæ Save Email Config</button>
        <p id="ejsStatus" style="font-size:0.72rem;color:var(--green);display:none;">‚úì Config saved! Contact form will now email you.</p>
      </div>
    </div>

    <!-- ‚îÄ CHANGE PASSWORD ‚îÄ -->
    <div class="admin-section">
      <h3>üîë Change Login Credentials</h3>
      <div class="admin-form">
        <div class="admin-row">
          <div>
            <label class="a-label">New Username</label>
            <input class="a-input" id="newUser" placeholder="New username">
          </div>
          <div>
            <label class="a-label">New Password (min 6 chars)</label>
            <input class="a-input" type="password" id="newPass" placeholder="New password">
          </div>
        </div>
        <button class="admin-add-btn" onclick="changeCredentials()">üîí Save Credentials</button>
      </div>
    </div>

  </div><!-- /admin-body -->
</div><!-- /admin-panel -->

<!-- ‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê -->
<nav>
  <div class="nav-brand"><div class="nav-dot"></div>dp.devops</div>
  <ul class="nav-links">
    <li><a href="#skills">Skills</a></li>
    <li><a href="#projects">Projects</a></li>
    <li><a href="#certifications">Certifications</a></li>
    <li><a href="#contact">Contact</a></li>
  </ul>
  <button class="nav-admin-btn" onclick="openLogin()">üîê Admin</button>
</nav>

<!-- ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê -->
<section id="hero">
  <div class="hero-bg-grid"></div>
  <div class="hero-glow"></div>
  <div class="hero-glow2"></div>

  <div class="hero-left">
    <div class="hero-badge"><div class="nav-dot"></div>Open to Work ‚Äî Bengaluru, India</div>
    <h1 class="hero-name">Darshan<br><span class="last">Patgar</span></h1>
    <div class="hero-title">
      <span>DevOps Engineer</span><span class="sep">/</span>
      <span>Cloud Engineer</span><span class="sep">/</span>
      <span>SRE Focused</span>
    </div>
    <p class="hero-desc">MCA graduate with hands-on experience in CI/CD automation, containerization, Kubernetes orchestration, monitoring, and DevSecOps security practices. Building automated software delivery pipelines on AWS.</p>
    <div class="hero-btns">
      <a href="#projects" class="btn-fill" onclick="event.preventDefault();document.getElementById('projects').scrollIntoView({behavior:'smooth',block:'start'})">View Projects ‚Üí</a>
      <a href="#contact" class="btn-ghost" onclick="event.preventDefault();document.getElementById('contact').scrollIntoView({behavior:'smooth',block:'start'})">Get in Touch</a>
    </div>
    <div class="stats-row">
      <div class="stat-box"><div class="stat-val">3+</div><div class="stat-key">Projects</div></div>
      <div class="stat-box"><div class="stat-val">4</div><div class="stat-key">Certifications</div></div>
      <div class="stat-box"><div class="stat-val">8.42</div><div class="stat-key">MCA CGPA</div></div>
      <div class="stat-box"><div class="stat-val">10+</div><div class="stat-key">Tech Stack</div></div>
    </div>
  </div>

  <div class="hero-right">
    <div class="terminal">
      <div class="terminal-header">
        <div class="t-btn r"></div><div class="t-btn y"></div><div class="t-btn g"></div>
        <span class="t-label">terminal ‚Äî darshan@devops</span>
      </div>
      <div class="terminal-body">
        <div><span class="t-comment"># Check cluster health</span></div>
        <div><span class="t-prompt">$ </span><span class="t-cmd">kubectl get pods -n prod</span></div>
        <div class="t-ok">spring-app-7d8f9c &nbsp;&nbsp;Running &nbsp;1/1</div>
        <div class="t-ok">prometheus-6bc4d &nbsp;&nbsp;&nbsp;Running &nbsp;1/1</div>
        <div class="t-ok">grafana-5f9d2b &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Running &nbsp;1/1</div>
        <br>
        <div><span class="t-prompt">$ </span><span class="t-cmd">jenkins pipeline status</span></div>
        <div class="t-ok">‚úì Build: SUCCESS (32s)</div>
        <div class="t-ok">‚úì SonarQube: PASSED</div>
        <div class="t-warn">‚ö° Trivy: 0 CRITICAL found</div>
        <br>
        <div><span class="t-prompt">$ </span><span class="t-cmd">terraform apply --auto-approve</span></div>
        <div class="t-ok">Apply complete! 12 resources added.</div>
        <br>
        <div><span class="t-prompt">$ </span><span class="t-cursor"></span></div>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê SKILLS ‚ïê‚ïê‚ïê -->
<section class="section section-alt" id="skills">
  <div class="sec-label">
    <span class="sec-num">01 //</span>
    <h2 class="sec-title">Technical Skills</h2>
    <div class="sec-line"></div>
  </div>
  <div class="skills-grid" id="skillsGrid"></div>
</section>

<!-- ‚ïê‚ïê‚ïê PROJECTS ‚ïê‚ïê‚ïê -->
<section class="section" id="projects">
  <div class="sec-label">
    <span class="sec-num">02 //</span>
    <h2 class="sec-title">Projects</h2>
    <div class="sec-line"></div>
  </div>
  <div class="projects-grid" id="projectsGrid">
    <div class="proj-card reveal" data-id="p-d1">
      <div class="proj-header"><div class="proj-icon">üîê</div><span class="proj-num">01</span></div>
      <div class="proj-title">DevSecOps CI/CD Pipeline</div>
      <p class="proj-desc">End-to-end DevSecOps pipeline automating build, test, scan, package and deployment of a Spring Boot application. SonarQube + Trivy for zero-critical secure delivery on Kubernetes.</p>
      <div class="proj-tags"><span class="proj-tag">Jenkins</span><span class="proj-tag">SonarQube</span><span class="proj-tag">Trivy</span><span class="proj-tag">Docker</span><span class="proj-tag">Kubernetes</span><span class="proj-tag">Prometheus</span><span class="proj-tag">Grafana</span></div>
      <a class="proj-gh-link" href="https://github.com/darshan090905" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" style="width:13px;height:13px;fill:currentColor;"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg> View on GitHub</a>
    </div>
    <div class="proj-card reveal" data-id="p-d2">
      <div class="proj-header"><div class="proj-icon">üõí</div><span class="proj-num">02</span></div>
      <div class="proj-title">E-Commerce DevOps Implementation</div>
      <p class="proj-desc">Full DevOps lifecycle for an e-commerce platform with microservices on AWS EKS provisioned with Terraform. GitOps-based continuous deployment using GitHub Actions and Argo CD.</p>
      <div class="proj-tags"><span class="proj-tag">AWS EKS</span><span class="proj-tag">Terraform</span><span class="proj-tag">GitHub Actions</span><span class="proj-tag">Argo CD</span><span class="proj-tag">VPC</span><span class="proj-tag">Route 53</span></div>
    </div>
    <div class="proj-card reveal" data-id="p-d3">
      <div class="proj-header"><div class="proj-icon">ü§ñ</div><span class="proj-num">03</span></div>
      <div class="proj-title">GitHub‚ÄìJIRA Automation</div>
      <p class="proj-desc">Python Flask webhook integration between GitHub and JIRA. Automated ticket creation via REST APIs with duplicate prevention logic to streamline developer issue tracking workflows.</p>
      <div class="proj-tags"><span class="proj-tag">Python</span><span class="proj-tag">Flask</span><span class="proj-tag">GitHub Webhooks</span><span class="proj-tag">JIRA REST API</span></div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê CERTIFICATIONS ‚ïê‚ïê‚ïê -->
<section class="section section-alt" id="certifications">
  <div class="sec-label">
    <span class="sec-num">03 //</span>
    <h2 class="sec-title">Certifications</h2>
    <div class="sec-line"></div>
  </div>
  <div class="cert-grid" id="certGrid">
    <div class="cert-card" data-id="cd1" onclick="noCertFile()">
      <div class="cert-ico">üîí</div>
      <div><div class="cert-name">Cisco Certified Support Technician ‚Äì Cybersecurity</div><div class="cert-by">Cisco</div></div>
    </div>
    <div class="cert-card" data-id="cd2" onclick="noCertFile()">
      <div class="cert-ico blue">‚òÅ</div>
      <div><div class="cert-name">Microsoft Azure Fundamentals AZ-900</div><div class="cert-by">Microsoft</div></div>
    </div>
    <div class="cert-card" data-id="cd3" onclick="noCertFile()">
      <div class="cert-ico green">üåê</div>
      <div><div class="cert-name">IT Specialist ‚Äì Network Security</div><div class="cert-by">Certiport / Pearson VUE</div></div>
    </div>
    <div class="cert-card" style="cursor:default;" data-id="cd4">
      <div class="cert-ico pending">‚è≥</div>
      <div><div class="cert-name">AWS Cloud Practitioner</div><div class="cert-by">Amazon Web Services</div><div class="cert-status">‚óè In Progress</div></div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê CONTACT ‚ïê‚ïê‚ïê -->
<section class="section" id="contact">
  <div class="sec-label">
    <span class="sec-num">04 //</span>
    <h2 class="sec-title">Get in Touch</h2>
    <div class="sec-line"></div>
  </div>
  <div class="contact-wrap">
    <div class="contact-info reveal">
      <h3>Let's build something <span style="color:var(--accent)">reliable together.</span></h3>
      <p>Actively seeking DevOps and Cloud Engineer roles. Whether you have a position, project, or just want to talk infrastructure ‚Äî reach out anytime.</p>
      <div class="contact-links">
        <a href="mailto:darshanpatgar230@gmail.com" class="c-link">
          <div class="c-ico">‚úâ</div>
          <div><span class="c-lbl">Email</span><span>darshanpatgar230@gmail.com</span></div>
        </a>
        <a href="https://www.linkedin.com/in/darshan-patgar" target="_blank" class="c-link">
          <div class="c-ico" style="font-size:0.75rem;font-weight:700;">in</div>
          <div><span class="c-lbl">LinkedIn</span>linkedin.com/in/darshan-patgar</div>
        </a>
        <a href="https://github.com/darshan090905" target="_blank" class="c-link">
          <div class="c-ico" style="font-size:0.72rem;font-weight:700;">gh</div>
          <div><span class="c-lbl">GitHub</span>github.com/darshan090905</div>
        </a>
        <a href="https://darshan090905-devops.hashnode.dev/" target="_blank" class="c-link">
          <div class="c-ico">‚úè</div>
          <div><span class="c-lbl">Blog</span>darshan090905-devops.hashnode.dev</div>
        </a>
        <div class="c-link" style="cursor:default;">
          <div class="c-ico">üìû</div>
          <div><span class="c-lbl">Phone</span>+91 6363200133</div>
        </div>
      </div>
    </div>

    <div class="reveal">
      <div class="contact-form">
        <div class="f-group">
          <label class="f-label">Name</label>
          <input class="f-input" id="fName" placeholder="Your name">
        </div>
        <div class="f-group">
          <label class="f-label">Email</label>
          <input class="f-input" id="fEmail" type="email" placeholder="your@email.com">
        </div>
        <div class="f-group">
          <label class="f-label">Message</label>
          <textarea class="f-textarea" id="fMsg" placeholder="Tell me about the opportunity..."></textarea>
        </div>
        <button class="btn-fill send-btn" id="sendBtn" onclick="sendMsg()">
          <span id="sendLabel">Send Message ‚Üí</span>
          <span class="btn-spinner" id="sendSpinner"></span>
        </button>
      </div>
    </div>
  </div>
</section>

<footer>
  <span>Darshan Patgar ¬∑ DevOps Engineer ¬∑ Bengaluru, India</span>
  <span class="f-right">MCA REVA University ¬∑ CGPA 8.42</span>
</footer>

<!-- Edit Project Modal -->
<div class="edit-modal" id="editProjModal">
  <div class="edit-box">
    <button class="edit-close" onclick="closeEditProj()">‚úï</button>
    <h3>‚úè Edit Project</h3>
    <div class="edit-form">
      <input type="hidden" id="epId">
      <div class="edit-row">
        <div><label class="a-label">Title *</label><input class="a-input" id="epTitle" placeholder="Project title"></div>
        <div><label class="a-label">Icon</label><input class="a-input" id="epIcon" maxlength="4"></div>
      </div>
      <div><label class="a-label">Description *</label><textarea class="a-textarea" id="epDesc"></textarea></div>
      <div><label class="a-label">Tech Stack (comma separated)</label><input class="a-input" id="epTech" placeholder="Docker, Kubernetes..."></div>
      <div><label class="a-label">GitHub URL</label><input class="a-input" id="epGithub" placeholder="https://github.com/..."></div>
      <div class="edit-actions">
        <button class="btn-save" onclick="saveEditProj()">üíæ Save Changes</button>
        <button class="btn-cancel-edit" onclick="closeEditProj()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Certificate Modal -->
<div class="edit-modal" id="editCertModal">
  <div class="edit-box">
    <button class="edit-close" onclick="closeEditCert()">‚úï</button>
    <h3>‚úè Edit Certificate</h3>
    <div class="edit-form">
      <input type="hidden" id="ecId">
      <div class="edit-row">
        <div><label class="a-label">Certificate Name *</label><input class="a-input" id="ecName" placeholder="Certificate name"></div>
        <div><label class="a-label">Issuing Organization *</label><input class="a-input" id="ecIssuer" placeholder="Organization"></div>
      </div>
      <div class="edit-row">
        <div>
          <label class="a-label">Status</label>
          <select class="a-select" id="ecStatus">
            <option value="earned">‚úÖ Earned</option>
            <option value="progress">‚è≥ In Progress</option>
          </select>
        </div>
        <div>
          <label class="a-label">Credential URL (optional)</label>
          <input class="a-input" id="ecCred" placeholder="https://www.credly.com/badges/...">
        </div>
      </div>
      <div>
        <label class="a-label">Replace Image/File (optional)</label>
        <input type="file" id="ecFile" accept=".pdf,.png,.jpg,.jpeg" onchange="onEcFile(this)">
        <button class="admin-add-btn" style="margin-top:0.4rem;padding:0.35rem 0.9rem;font-size:0.7rem;" onclick="document.getElementById('ecFile').click()">üìé Browse</button>
        <span id="ecFileName" style="font-size:0.65rem;color:var(--green);display:block;margin-top:0.3rem;"></span>
      </div>
      <div class="edit-actions">
        <button class="btn-save" onclick="saveEditCert()">üíæ Save Changes</button>
        <button class="btn-cancel-edit" onclick="closeEditCert()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Skill Modal -->
<div class="edit-modal" id="editSkillModal">
  <div class="edit-box">
    <button class="edit-close" onclick="closeEditSkill()">‚úï</button>
    <h3>‚úè Edit Skill Category</h3>
    <div class="edit-form">
      <input type="hidden" id="esId">
      <div class="edit-row">
        <div><label class="a-label">Icon</label><input class="a-input" id="esIcon" maxlength="4"></div>
        <div><label class="a-label">Category Name *</label><input class="a-input" id="esCategory" placeholder="Category name"></div>
      </div>
      <div><label class="a-label">Skills/Tools (comma separated) *</label><input class="a-input" id="esTags" placeholder="Tool1, Tool2..."></div>
      <div class="edit-actions">
        <button class="btn-save" onclick="saveEditSkill()">üíæ Save Changes</button>
        <button class="btn-cancel-edit" onclick="closeEditSkill()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CRYPTO ‚Äî SHA-256, never store plain passwords
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function sha256(str) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

// Version key ‚Äî forces credential reset when site is updated.
// Change CRED_VERSION if you ever need to reset to defaults again.
const CRED_VERSION = 'v3';
async function initCreds() {
  if (localStorage.getItem('dp_cv') !== CRED_VERSION) {
    // Wipe any stale hashes from a previous version
    localStorage.removeItem('dp_uh');
    localStorage.removeItem('dp_ph');
    localStorage.setItem('dp_cv', CRED_VERSION);
  }
  if (!localStorage.getItem('dp_uh') || !localStorage.getItem('dp_ph')) {
    const [uh, ph] = await Promise.all([sha256('darshan'), sha256('devops@2025')]);
    localStorage.setItem('dp_uh', uh);
    localStorage.setItem('dp_ph', ph);
  }
  // Reset login attempts on page load
  loginAttempts = 0;
  if (document.getElementById('loginHint')) {
    document.getElementById('loginHint').style.display = 'none';
  }
}
initCreds();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let projects = [];
let certs = [];
let skills = [];
let certFiles = {};
let projCount = 3;
let certCount = 4;
let skillCount = 6;
let selectedCertFile = null;
let messages = JSON.parse(localStorage.getItem('dp_inbox') || '[]');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCROLL REVEAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const revealIO = new IntersectionObserver(entries => {
  entries.forEach((e, i) => {
    if (e.isIntersecting) setTimeout(() => e.target.classList.add('in'), i * 70);
  });
}, { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => revealIO.observe(el));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, type) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + (type || '');
  t.classList.add('show');
  clearTimeout(t._to);
  t._to = setTimeout(() => t.classList.remove('show'), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openLogin() {
  document.getElementById('loginOverlay').classList.add('active');
  setTimeout(() => document.getElementById('loginUser').focus(), 100);
}
function closeLogin() {
  document.getElementById('loginOverlay').classList.remove('active');
  document.getElementById('loginUser').value = '';
  document.getElementById('loginPass').value = '';
}

let loginAttempts = 0;

async function doLogin(event) {
  if (event) event.preventDefault(); // Prevent form submission
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  const btn = document.getElementById('loginBtn');

  if (!u || !p) { toast('Please enter both username and password', 'error'); return; }

  btn.disabled = true;
  btn.textContent = 'Verifying...';

  try {
    const [uh, ph] = await Promise.all([sha256(u), sha256(p)]);
    const storedUh = localStorage.getItem('dp_uh');
    const storedPh = localStorage.getItem('dp_ph');

    if (uh === storedUh && ph === storedPh) {
      loginAttempts = 0;
      closeLogin();
      document.getElementById('adminPanel').classList.add('active');
      document.body.style.overflow = 'hidden';
      loadEmailConfig();
      renderInbox();
      refreshAdminLists();
      toast('‚úì Welcome back, Darshan!', 'success');
    } else {
      loginAttempts++;
      const f1 = document.getElementById('loginUser');
      const f2 = document.getElementById('loginPass');
      f1.style.borderColor = 'var(--red)';
      f2.style.borderColor = 'var(--red)';
      setTimeout(() => { f1.style.borderColor = ''; f2.style.borderColor = ''; }, 1500);
      if (loginAttempts >= 3) {
        document.getElementById('loginHint').style.display = 'block';
      }
      toast('‚ùå Incorrect credentials', 'error');
    }
  } catch(err) {
    toast('Login error: ' + err.message, 'error');
  }

  btn.disabled = false;
  btn.textContent = '‚Üí Sign In';
}

document.getElementById('loginOverlay').addEventListener('click', e => { if(e.target===document.getElementById('loginOverlay')) closeLogin(); });
// Form submit handler now handles Enter key on mobile and desktop

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function closeAdmin() {
  document.getElementById('adminPanel').classList.remove('active');
  document.body.style.overflow = '';
}

async function changeCredentials() {
  const u = document.getElementById('newUser').value.trim();
  const p = document.getElementById('newPass').value;
  if (!u || !p) { toast('Fill both fields', 'error'); return; }
  if (p.length < 6) { toast('Password must be at least 6 characters', 'error'); return; }
  const [uh, ph] = await Promise.all([sha256(u), sha256(p)]);
  localStorage.setItem('dp_uh', uh);
  localStorage.setItem('dp_ph', ph);
  document.getElementById('newUser').value = '';
  document.getElementById('newPass').value = '';
  toast('‚úì Credentials saved securely! (SHA-256 hashed)', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMAILJS CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveEmailConfig() {
  const sid = document.getElementById('ejs_sid').value.trim();
  const tid = document.getElementById('ejs_tid').value.trim();
  const pk  = document.getElementById('ejs_pk').value.trim();
  if (!sid || !tid || !pk) { toast('Fill all three EmailJS fields', 'error'); return; }
  localStorage.setItem('dp_ejs_sid', sid);
  localStorage.setItem('dp_ejs_tid', tid);
  localStorage.setItem('dp_ejs_pk',  pk);
  emailjs.init(pk);
  document.getElementById('ejsStatus').style.display = 'block';
  toast('‚úì Email config saved!', 'success');
}

function loadEmailConfig() {
  const sid = localStorage.getItem('dp_ejs_sid') || '';
  const tid = localStorage.getItem('dp_ejs_tid') || '';
  const pk  = localStorage.getItem('dp_ejs_pk')  || '';
  document.getElementById('ejs_sid').value = sid;
  document.getElementById('ejs_tid').value = tid;
  document.getElementById('ejs_pk').value  = pk;
  if (sid && tid && pk) {
    emailjs.init(pk);
    document.getElementById('ejsStatus').style.display = 'block';
  }
}

// Init EmailJS on load if config exists
(function() {
  const pk = localStorage.getItem('dp_ejs_pk');
  if (pk) emailjs.init(pk);
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTACT FORM + INBOX
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function sendMsg() {
  const name  = document.getElementById('fName').value.trim();
  const email = document.getElementById('fEmail').value.trim();
  const msg   = document.getElementById('fMsg').value.trim();

  if (!name)  { toast('Please enter your name', 'error'); return; }
  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { toast('Please enter a valid email', 'error'); return; }
  if (!msg)   { toast('Please write a message', 'error'); return; }

  const btn = document.getElementById('sendBtn');
  document.getElementById('sendLabel').style.display = 'none';
  document.getElementById('sendSpinner').style.display = 'inline-block';
  btn.disabled = true;

  // Always save to local inbox
  const entry = { id: 'msg-' + Date.now(), name, email, msg, time: new Date().toISOString(), read: false };
  messages.unshift(entry);
  localStorage.setItem('dp_inbox', JSON.stringify(messages));

  // Try EmailJS if configured
  const sid = localStorage.getItem('dp_ejs_sid');
  const tid = localStorage.getItem('dp_ejs_tid');
  let emailSent = false;

  if (sid && tid) {
    try {
      await emailjs.send(sid, tid, {
        from_name:  name,
        from_email: email,
        message:    msg,
        to_email:   'darshanpatgar230@gmail.com'
      });
      emailSent = true;
    } catch(err) {
      console.warn('EmailJS error:', err);
    }
  }

  document.getElementById('sendLabel').style.display = 'inline';
  document.getElementById('sendSpinner').style.display = 'none';
  btn.disabled = false;

  document.getElementById('fName').value = '';
  document.getElementById('fEmail').value = '';
  document.getElementById('fMsg').value = '';

  if (emailSent) {
    toast('‚úì Message sent! Darshan will reply soon.', 'success');
  } else {
    toast('‚úì Message received! (Set up EmailJS in admin for email alerts)', 'success');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INBOX RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderInbox() {
  messages = JSON.parse(localStorage.getItem('dp_inbox') || '[]');
  const list = document.getElementById('inboxList');
  const badge = document.getElementById('inboxBadge');
  const unread = messages.filter(m => !m.read).length;

  if (unread > 0) {
    badge.textContent = unread;
    badge.style.display = 'inline-flex';
  } else {
    badge.style.display = 'none';
  }

  if (messages.length === 0) {
    list.innerHTML = '<p class="empty-note">No messages yet. Messages from visitors will appear here.</p>';
    return;
  }

  list.innerHTML = messages.map(m => {
    const d = new Date(m.time);
    const timeStr = d.toLocaleDateString('en-IN', { day:'2-digit', month:'short', year:'numeric' }) + ' ' + d.toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit' });
    return `
      <div class="inbox-msg ${m.read ? '' : 'unread'}" id="inbox-${m.id}" onclick="markRead('${m.id}')">
        <button class="inbox-del" onclick="event.stopPropagation(); deleteMsg('${m.id}')">üóë</button>
        <div class="inbox-meta">
          <span class="inbox-from">${esc(m.name)}</span>
          <a class="inbox-email" href="mailto:${esc(m.email)}">${esc(m.email)}</a>
          <span class="inbox-time">${timeStr}</span>
        </div>
        <div class="inbox-text">${esc(m.msg)}</div>
      </div>
    `;
  }).join('');
}

function markRead(id) {
  messages = messages.map(m => m.id === id ? {...m, read: true} : m);
  localStorage.setItem('dp_inbox', JSON.stringify(messages));
  const el = document.getElementById('inbox-' + id);
  if (el) el.classList.remove('unread');
  const unread = messages.filter(m => !m.read).length;
  const badge = document.getElementById('inboxBadge');
  if (unread > 0) { badge.textContent = unread; } else { badge.style.display = 'none'; }
}

function deleteMsg(id) {
  messages = messages.filter(m => m.id !== id);
  localStorage.setItem('dp_inbox', JSON.stringify(messages));
  renderInbox();
  toast('Message deleted');
}

function esc(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROJECTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('pTech').addEventListener('input', function() {
  const tags = this.value.split(',').map(t => t.trim()).filter(Boolean);
  document.getElementById('pTechPreview').innerHTML = tags.map(t => `<span class="admin-tag-pill">${esc(t)}</span>`).join('');
});

document.getElementById('sTags').addEventListener('input', function() {
  const tags = this.value.split(',').map(t => t.trim()).filter(Boolean);
  document.getElementById('sTagsPreview').innerHTML = tags.map(t => `<span class="admin-tag-pill">${esc(t)}</span>`).join('');
});

function addProject() {
  const title  = document.getElementById('pTitle').value.trim();
  const desc   = document.getElementById('pDesc').value.trim();
  const icon   = document.getElementById('pIcon').value.trim() || 'üîß';
  const tech   = document.getElementById('pTech').value.trim();
  const github = document.getElementById('pGithub').value.trim();
  if (!title || !desc) { toast('Title and description are required', 'error'); return; }
  const tags = tech.split(',').map(t => t.trim()).filter(Boolean);
  projCount++;
  const id = 'p-' + Date.now();
  projects.push({ id, title, desc, icon, tags, github });
  saveProjectsToStorage();
  renderProjectsGrid();
  document.getElementById('pTitle').value = '';
  document.getElementById('pDesc').value = '';
  document.getElementById('pIcon').value = 'üîß';
  document.getElementById('pTech').value = '';
  document.getElementById('pGithub').value = '';
  document.getElementById('pTechPreview').innerHTML = '';
  refreshAdminLists();
  toast('‚úì Project added!', 'success');
}

function deleteProject(id) {
  projects = projects.filter(p => p.id !== id);
  saveProjectsToStorage();
  renderProjectsGrid();
  refreshAdminLists();
  toast('Project removed');
}

function renderProjectsGrid() {
  const grid = document.getElementById('projectsGrid');
  if (!grid) return;
  const GH_SVG = `<svg viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>`;
  grid.innerHTML = projects.map((p, i) => `
    <div class="proj-card reveal" data-id="${p.id}">
      <div class="proj-header"><div class="proj-icon">${esc(p.icon || 'üîß')}</div><span class="proj-num">${String(i + 1).padStart(2, '0')}</span></div>
      <div class="proj-title">${esc(p.title)}</div>
      <p class="proj-desc">${esc(p.desc)}</p>
      <div class="proj-tags">${(p.tags || []).map(t => `<span class="proj-tag">${esc(t)}</span>`).join('')}</div>
      ${p.github ? `<a class="proj-gh-link" href="${esc(p.github)}" target="_blank" rel="noopener">${GH_SVG} View on GitHub</a>` : ''}
    </div>
  `).join('');
  grid.querySelectorAll('.reveal').forEach(el => revealIO.observe(el));
}

function saveProjectsToStorage() {
  const projectsData = projects.map(p => ({
    id: p.id,
    title: p.title,
    icon: p.icon,
    desc: p.desc,
    tags: Array.isArray(p.tags) ? p.tags : [],
    github: p.github || ''
  }));
  try {
    localStorage.setItem('dp_projects', JSON.stringify(projectsData));
  } catch (err) {
    toast('Project data is too large for browser storage.', 'error');
    console.warn('Failed to save projects:', err);
  }
}

function loadProjectsFromStorage() {
  const saved = localStorage.getItem('dp_projects');
  if (!saved) return;
  try {
    const savedProjects = JSON.parse(saved);
    if (!Array.isArray(savedProjects)) return;
    projects = projects.map(defaultProject => {
      const match = savedProjects.find(s => s.id === defaultProject.id);
      return match ? { ...defaultProject, ...match } : defaultProject;
    });
    const newProjects = savedProjects.filter(s => !DEFAULT_PROJECTS.some(d => d.id === s.id));
    projects.push(...newProjects);
    projCount = projects.length;
  } catch (err) {
    console.warn('Failed to load saved projects:', err);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILE TO BASE64 CONVERTER & INDEXEDDB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function base64ToBlob(base64, type) {
  const arr = base64.split(',');
  const bstr = atob(arr[1]);
  const n = bstr.length;
  const u8arr = new Uint8Array(n);
  for (let i = 0; i < n; i++) {
    u8arr[i] = bstr.charCodeAt(i);
  }
  return new Blob([u8arr], { type });
}

// IndexedDB for large files
let idb = null;
function initIndexedDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open('DarshanPortfolio', 1);
    req.onupgradeneeded = (e) => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains('certFiles')) {
        db.createObjectStore('certFiles');
      }
    };
    req.onsuccess = () => { idb = req.result; resolve(); };
    req.onerror = () => reject(req.error);
  });
}

async function saveCertFileToIDB(certId, blob) {
  if (!idb) await initIndexedDB();
  return new Promise((resolve, reject) => {
    const tx = idb.transaction(['certFiles'], 'readwrite');
    const store = tx.objectStore('certFiles');
    const req = store.put(blob, certId);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

async function loadCertFileFromIDB(certId) {
  if (!idb) await initIndexedDB();
  return new Promise((resolve, reject) => {
    const tx = idb.transaction(['certFiles'], 'readonly');
    const store = tx.objectStore('certFiles');
    const req = store.get(certId);
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

async function deleteCertFileFromIDB(certId) {
  if (!idb) await initIndexedDB();
  return new Promise((resolve, reject) => {
    const tx = idb.transaction(['certFiles'], 'readwrite');
    const store = tx.objectStore('certFiles');
    const req = store.delete(certId);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CERTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MAX_CERT_FILE_SIZE = 2 * 1024 * 1024;

function onCertFile(input) {
  selectedCertFile = input.files[0] || null;
  if (selectedCertFile && selectedCertFile.size > MAX_CERT_FILE_SIZE) {
    toast('File too large. Please upload a PDF/image smaller than 2 MB.', 'error');
    input.value = '';
    selectedCertFile = null;
    document.getElementById('certFileName').textContent = '';
    return;
  }
  document.getElementById('certFileName').textContent = selectedCertFile ? '‚úì ' + selectedCertFile.name : '';
}

// Convert and save file to IndexedDB with metadata in localStorage
async function addCert() {
  const name   = document.getElementById('cName').value.trim();
  const issuer = document.getElementById('cIssuer').value.trim();
  const status = document.getElementById('cStatus').value;
  const credentialUrl = document.getElementById('cCred').value.trim();
  if (!name || !issuer) { toast('Name and issuer are required', 'error'); return; }
  
  certCount++;
  const id = 'c-' + Date.now();
  let fileName = null, fileType = null;
  
  // Save file to IndexedDB if selected
  if (selectedCertFile) {
    if (selectedCertFile.size > MAX_CERT_FILE_SIZE) {
      toast('File too large. Please upload a PDF/image smaller than 2 MB.', 'error');
      return;
    }
    
    try {
      fileName = selectedCertFile.name;
      fileType = selectedCertFile.type;
      await saveCertFileToIDB(id, selectedCertFile);
      
      // Create blob URL for display
      const url = URL.createObjectURL(selectedCertFile);
      certFiles[id] = { url, name: fileName, type: fileType };
    } catch (err) {
      toast('Error saving file: ' + err.message, 'error');
      return;
    }
  }
  
  const isImage = fileType && fileType.startsWith('image/');
  const cert = { id, name, issuer, status, fileName, fileType, isImage, credentialUrl };
  certs.push(cert);

  if (!saveCertsToStorage()) {
    certs = certs.filter(c => c.id !== id);
    if (certFiles[id]) {
      URL.revokeObjectURL(certFiles[id].url);
      delete certFiles[id];
    }
    return;
  }
  
  renderCertGrid();
  
  document.getElementById('cName').value = '';
  document.getElementById('cIssuer').value = '';
  document.getElementById('cStatus').value = 'earned';
  document.getElementById('cCred').value = '';
  document.getElementById('certFileAdmin').value = '';
  document.getElementById('certFileName').textContent = '';
  selectedCertFile = null;
  refreshAdminLists();
  toast('‚úì Certificate added!', 'success');
}

function deleteCert(id) {
  const removedCert = certs.find(c => c.id === id);
  const removedFile = certFiles[id] ? { ...certFiles[id] } : null;
  if (certFiles[id]) { URL.revokeObjectURL(certFiles[id].url); delete certFiles[id]; }
  certs = certs.filter(c => c.id !== id);
  if (!saveCertsToStorage()) {
    if (removedCert) certs.push(removedCert);
    if (removedFile) certFiles[id] = removedFile;
    renderCertGrid();
    return;
  }
  if (removedCert && removedCert.fileName) deleteCertFileFromIDB(id).catch(e => console.warn('Cleanup error:', e));
  renderCertGrid();
  refreshAdminLists();
  toast('Certificate removed');
}

function noCertFile() { toast('Upload the certificate PDF via Admin panel to enable preview.'); }

function inferFileTypeFromUrl(url) {
  if (!url) return '';
  const lower = url.toLowerCase();
  if (lower.endsWith('.png') || lower.endsWith('.jpg') || lower.endsWith('.jpeg') || lower.endsWith('.webp') || lower.endsWith('.gif')) {
    return 'image/*';
  }
  if (lower.endsWith('.pdf')) return 'application/pdf';
  return '';
}

function getCertAsset(cert) {
  const uploaded = certFiles[cert.id];
  if (uploaded && uploaded.url) {
    return {
      url: uploaded.url,
      type: uploaded.type || cert.fileType || '',
      name: uploaded.name || cert.fileName || cert.name
    };
  }
  if (cert.fileUrl) {
    return {
      url: encodeURI(cert.fileUrl),
      type: cert.fileType || inferFileTypeFromUrl(cert.fileUrl),
      name: cert.fileName || cert.name
    };
  }
  return null;
}

function shouldOpenPdfExternally() {
  const ua = navigator.userAgent || '';
  return /Android|iPhone|iPad|iPod|Mobile/i.test(ua);
}

function renderCertGrid() {
  const grid = document.getElementById('certGrid');
  if (!grid) return;
  grid.innerHTML = '';
  certs.forEach(cert => {
    const card = document.createElement('div');
    renderCertCard(card, cert);
    grid.appendChild(card);
  });
}

function renderCertCard(card, cert) {
  const asset = getCertAsset(cert);
  const fileUrl = asset ? asset.url : null;
  const isImg = !!(asset && asset.type && asset.type.startsWith('image/'));
  const ico = cert.status === 'progress' ? '‚è≥' : 'üèÖ';
  const icoCls = cert.status === 'progress' ? 'pending' : 'green';
  card.dataset.id = cert.id;
  card.onclick = fileUrl ? () => openCert(cert.id) : () => toast('No file uploaded for this cert.');

  if (isImg && fileUrl) {
    card.className = 'cert-card has-img';
    card.innerHTML = `
      <button class="cert-del" onclick="event.stopPropagation(); deleteCert('${cert.id}')">‚úï</button>
      <div class="cert-img-wrap"><img src="${fileUrl}" alt="${esc(cert.name)}" loading="lazy"></div>
      <div style="padding:0 0.2rem;">
        <div class="cert-name">${esc(cert.name)}</div>
        <div class="cert-by">${esc(cert.issuer)}</div>
        ${cert.status==='progress'?'<div class="cert-status">‚óè In Progress</div>':''}
        <div class="cert-actions">
          ${cert.credentialUrl ? `<a class="cert-cred-btn" href="${esc(cert.credentialUrl)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">üîó Show Credential</a>` : ''}
        </div>
      </div>
    `;
    return;
  }

  card.className = 'cert-card';
  card.innerHTML = `
    <button class="cert-del" onclick="event.stopPropagation(); deleteCert('${cert.id}')">‚úï</button>
    <div class="cert-ico ${icoCls}">${ico}</div>
    <div class="cert-main">
      <div class="cert-name">${esc(cert.name)}</div>
      <div class="cert-by">${esc(cert.issuer)}</div>
      ${cert.status==='progress'?'<div class="cert-status">‚óè In Progress</div>':''}
      <div class="cert-actions">
        ${cert.credentialUrl ? `<a class="cert-cred-btn" href="${esc(cert.credentialUrl)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">üîó Show Credential</a>` : ''}
        ${cert.fileName?`<span class="cert-file-tag">üìé ${esc(cert.fileName)}</span>`:''}
      </div>
    </div>
  `;
}

// PDF.js cache for fast rendering
let pdfCache = {};
let currentPdfDoc = null;
let currentPdfPage = 1;
let totalPdfPages = 0;

// Set PDF.js worker
if (typeof pdfjsLib !== 'undefined') {
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}

async function renderPdfPage(pageNum = 1) {
  if (!currentPdfDoc) return;
  try {
    const page = await currentPdfDoc.getPage(pageNum);
    const scale = 1.5;
    const viewport = page.getViewport({ scale });
    const canvas = document.getElementById('pdfCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    
    await page.render({ canvasContext: ctx, viewport }).promise;
    currentPdfPage = pageNum;
    document.getElementById('pdfPageNum').textContent = `Page ${pageNum} of ${totalPdfPages}`;
    document.getElementById('pdfPrevBtn').style.display = pageNum > 1 ? 'block' : 'none';
    document.getElementById('pdfNextBtn').style.display = pageNum < totalPdfPages ? 'block' : 'none';
  } catch (err) {
    console.error('PDF render error:', err);
  }
}

function pdfNextPage() {
  if (currentPdfPage < totalPdfPages) renderPdfPage(currentPdfPage + 1);
}

function pdfPrevPage() {
  if (currentPdfPage > 1) renderPdfPage(currentPdfPage - 1);
}

async function openCert(id) {
  const cert = certs.find(c => c.id === id);
  if (!cert) return;
  const asset = getCertAsset(cert);
  if (!asset) {
    toast('No file uploaded for this cert.');
    return;
  }

  document.getElementById('pdfLabel').textContent = asset.name;
  const frame = document.getElementById('pdfFrame');
  const imgView = document.getElementById('certImgView');
  if (asset.type && asset.type.startsWith('image/')) {
    frame.style.display = 'none';
    imgView.style.display = 'block';
    imgView.src = asset.url;
  } else {
    if (shouldOpenPdfExternally()) {
      const popup = window.open(asset.url, '_blank', 'noopener');
      if (!popup) {
        const link = document.createElement('a');
        link.href = asset.url;
        link.target = '_blank';
        link.rel = 'noopener';
        document.body.appendChild(link);
        link.click();
        link.remove();
      }
      return;
    }
    frame.style.display = 'block';
    imgView.style.display = 'none';
    frame.src = asset.url;
  }
  document.getElementById('pdfModal').classList.add('active');
}
function closePdf() {
  document.getElementById('pdfModal').classList.remove('active');
  document.getElementById('pdfFrame').src = '';
}
document.getElementById('pdfModal').addEventListener('click', e => { if(e.target===document.getElementById('pdfModal')) closePdf(); });


function openEditProj(id) {
  const p = projects.find(x => x.id === id);
  if (!p) return;
  document.getElementById('epId').value    = p.id;
  document.getElementById('epTitle').value = p.title;
  document.getElementById('epIcon').value  = p.icon;
  document.getElementById('epDesc').value  = p.desc;
  document.getElementById('epTech').value  = p.tags.join(', ');
  document.getElementById('epGithub').value = p.github || '';
  document.getElementById('editProjModal').classList.add('active');
}
function closeEditProj() {
  document.getElementById('editProjModal').classList.remove('active');
}
function saveEditProj() {
  const id     = document.getElementById('epId').value;
  const title  = document.getElementById('epTitle').value.trim();
  const icon   = document.getElementById('epIcon').value.trim() || 'üîß';
  const desc   = document.getElementById('epDesc').value.trim();
  const tech   = document.getElementById('epTech').value.trim();
  const github = document.getElementById('epGithub').value.trim();
  if (!title || !desc) { toast('Title and description are required', 'error'); return; }
  const tags = tech.split(',').map(t => t.trim()).filter(Boolean);
  const idx = projects.findIndex(x => x.id === id);
  if (idx === -1) return;
  projects[idx] = { ...projects[idx], title, icon, desc, tags, github };
  saveProjectsToStorage();
  renderProjectsGrid();
  closeEditProj();
  refreshAdminLists();
  toast('‚úì Project updated!', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EDIT CERTIFICATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let editCertNewFile = null;
function onEcFile(input) {
  editCertNewFile = input.files[0] || null;
  if (editCertNewFile && editCertNewFile.size > MAX_CERT_FILE_SIZE) {
    toast('File too large. Please upload a PDF/image smaller than 2 MB.', 'error');
    input.value = '';
    editCertNewFile = null;
    document.getElementById('ecFileName').textContent = 'No file uploaded';
    return;
  }
  document.getElementById('ecFileName').textContent = editCertNewFile ? '‚úì ' + editCertNewFile.name : '';
}

function openEditCert(id) {
  const cert = certs.find(x => x.id === id);
  if (!cert) return;
  document.getElementById('ecId').value     = cert.id;
  document.getElementById('ecName').value   = cert.name;
  document.getElementById('ecIssuer').value = cert.issuer;
  document.getElementById('ecStatus').value = cert.status;
  document.getElementById('ecCred').value   = cert.credentialUrl || '';
  document.getElementById('ecFile').value   = '';
  document.getElementById('ecFileName').textContent = cert.fileName ? 'üìé Current: ' + cert.fileName : 'No file uploaded';
  editCertNewFile = null;
  document.getElementById('editCertModal').classList.add('active');
}
function closeEditCert() {
  document.getElementById('editCertModal').classList.remove('active');
  editCertNewFile = null;
}
async function saveEditCert() {
  const id     = document.getElementById('ecId').value;
  const name   = document.getElementById('ecName').value.trim();
  const issuer = document.getElementById('ecIssuer').value.trim();
  const status = document.getElementById('ecStatus').value;
  const credentialUrl = document.getElementById('ecCred').value.trim();
  if (!name || !issuer) { toast('Name and issuer required', 'error'); return; }
  const idx = certs.findIndex(x => x.id === id);
  if (idx === -1) return;
  const previousCert = { ...certs[idx] };
  const previousFile = certFiles[id] ? { ...certFiles[id] } : null;
  let newFileUrl = null;
  
  // Handle new file
  if (editCertNewFile) {
    if (editCertNewFile.size > MAX_CERT_FILE_SIZE) {
      toast('File too large. Please upload a PDF/image smaller than 2 MB.', 'error');
      return;
    }
    
    if (certFiles[id]) URL.revokeObjectURL(certFiles[id].url);
    try {
      await saveCertFileToIDB(id, editCertNewFile);
      const url = URL.createObjectURL(editCertNewFile);
      newFileUrl = url;
      certFiles[id] = { url, name: editCertNewFile.name, type: editCertNewFile.type };
      certs[idx].fileName = editCertNewFile.name;
      certs[idx].fileType = editCertNewFile.type;
      certs[idx].isImage  = editCertNewFile.type.startsWith('image/');
    } catch (err) {
      toast('Error saving file: ' + err.message, 'error');
      return;
    }
  }
  certs[idx].name   = name;
  certs[idx].issuer = issuer;
  certs[idx].status = status;
  certs[idx].credentialUrl = credentialUrl;
  if (!saveCertsToStorage()) {
    certs[idx] = previousCert;
    if (newFileUrl) URL.revokeObjectURL(newFileUrl);
    if (previousFile) {
      certFiles[id] = previousFile;
    } else {
      delete certFiles[id];
    }
    renderCertGrid();
    return;
  }
  renderCertGrid();
  closeEditCert();
  refreshAdminLists();
  toast('‚úì Certificate updated!', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CERT STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveCertsToStorage() {
  const certsData = certs.map(c => ({
    id: c.id,
    name: c.name,
    issuer: c.issuer,
    status: c.status,
    fileName: c.fileName,
    isImage: c.isImage,
    credentialUrl: c.credentialUrl,
    fileType: c.fileType || null
  }));
  try {
    const jsonStr = JSON.stringify(certsData);
    const sizeKB = new Blob([jsonStr]).size / 1024;
    console.log('Saving certs, size:', sizeKB.toFixed(2), 'KB');
    localStorage.setItem('dp_certs', jsonStr);
    console.log('‚úì Certs saved to localStorage');
    return true;
  } catch (err) {
    console.error('Failed to save certs:', err.message);
    if (err.name === 'QuotaExceededError') {
      toast('Storage full. Try deleting certificates with large files.', 'error');
    } else {
      toast('Failed to save certificate data.', 'error');
    }
    return false;
  }
}

async function loadCertsFromStorage() {
  const saved = localStorage.getItem('dp_certs');
  if (saved) {
    try {
      const savedCerts = JSON.parse(saved);
      console.log('Loaded', savedCerts.length, 'certs from localStorage');
      await initIndexedDB();

      // One-time migration from old base64 records (if present)
      let migrated = false;
      for (const savedCert of savedCerts) {
        if (savedCert.fileBase64 && savedCert.fileType) {
          try {
            const blob = base64ToBlob(savedCert.fileBase64, savedCert.fileType);
            await saveCertFileToIDB(savedCert.id, blob);
            delete savedCert.fileBase64;
            migrated = true;
          } catch (err) {
            console.warn('Migration failed for', savedCert.id, err);
          }
        }
      }
      if (migrated) {
        localStorage.setItem('dp_certs', JSON.stringify(savedCerts));
      }
      
      certs = certs.map(defaultCert => {
        const match = savedCerts.find(s => s.id === defaultCert.id);
        return match ? { ...defaultCert, ...match } : defaultCert;
      });
      const newCerts = savedCerts.filter(s => !DEFAULT_CERTS.some(d => d.id === s.id));
      certs.push(...newCerts);

      // Clear old blob URLs
      Object.keys(certFiles).forEach(key => {
        try { URL.revokeObjectURL(certFiles[key].url); } catch (_) {}
      });
      certFiles = {};
      
      // Restore files from IndexedDB
      for (const savedCert of savedCerts) {
        if (savedCert.fileName && savedCert.fileType) {
          try {
            const blob = await loadCertFileFromIDB(savedCert.id);
            if (blob) {
              const url = URL.createObjectURL(blob);
              certFiles[savedCert.id] = { url, name: savedCert.fileName, type: savedCert.fileType };
              console.log('‚úì Restored file for cert:', savedCert.id);
            }
          } catch (err) {
            console.warn('Failed to restore file for cert', savedCert.id, err);
          }
        }
      }
    } catch (err) {
      console.error('Failed to load saved certs:', err);
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SKILLS MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSkillsGrid() {
  const grid = document.getElementById('skillsGrid');
  if (!grid) return;
  grid.innerHTML = skills.map(s => `
    <div class="skill-card reveal" data-id="${s.id}">
      <div class="sk-cat">${s.icon} ${esc(s.category)}</div>
      <div class="sk-tags">${s.tags.map(tag => `<span class="sk-tag">${esc(tag)}</span>`).join('')}</div>
    </div>
  `).join('');
  // Re-observe for scroll reveal
  grid.querySelectorAll('.reveal').forEach(el => revealIO.observe(el));
}

function addSkill() {
  const icon = document.getElementById('sIcon').value.trim() || '‚òÅ';
  const category = document.getElementById('sCategory').value.trim();
  const tagsInput = document.getElementById('sTags').value.trim();
  if (!category || !tagsInput) { toast('Category and skills required', 'error'); return; }
  const tags = tagsInput.split(',').map(t => t.trim()).filter(Boolean);
  skillCount++;
  const newSkill = { id: 'sk' + skillCount, icon, category, tags };
  skills.push(newSkill);
  saveSkillsToStorage();
  renderSkillsGrid();
  refreshAdminLists();
  document.getElementById('sIcon').value = '‚òÅ';
  document.getElementById('sCategory').value = '';
  document.getElementById('sTags').value = '';
  document.getElementById('sTagsPreview').innerHTML = '';
  toast('‚úì Skill category added!', 'success');
}

function openEditSkill(id) {
  const skill = skills.find(s => s.id === id);
  if (!skill) return;
  document.getElementById('esId').value = skill.id;
  document.getElementById('esIcon').value = skill.icon;
  document.getElementById('esCategory').value = skill.category;
  document.getElementById('esTags').value = skill.tags.join(', ');
  document.getElementById('editSkillModal').classList.add('active');
}

function closeEditSkill() {
  document.getElementById('editSkillModal').classList.remove('active');
}

function saveEditSkill() {
  const id = document.getElementById('esId').value;
  const icon = document.getElementById('esIcon').value.trim() || '‚òÅ';
  const category = document.getElementById('esCategory').value.trim();
  const tagsInput = document.getElementById('esTags').value.trim();
  if (!category || !tagsInput) { toast('Category and skills required', 'error'); return; }
  const tags = tagsInput.split(',').map(t => t.trim()).filter(Boolean);
  const idx = skills.findIndex(s => s.id === id);
  if (idx === -1) return;
  skills[idx] = { id, icon, category, tags };
  saveSkillsToStorage();
  renderSkillsGrid();
  closeEditSkill();
  refreshAdminLists();
  toast('‚úì Skill category updated!', 'success');
}

function deleteSkill(id) {
  if (!confirm('Delete this skill category?')) return;
  skills = skills.filter(s => s.id !== id);
  saveSkillsToStorage();
  renderSkillsGrid();
  refreshAdminLists();
  toast('‚úì Skill category deleted', 'info');
}

function saveSkillsToStorage() {
  localStorage.setItem('dp_skills', JSON.stringify(skills));
}

function loadSkillsFromStorage() {
  const saved = localStorage.getItem('dp_skills');
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      if (Array.isArray(parsed)) {
        skills = parsed;
        skillCount = Math.max(...skills.map(s => parseInt(s.id.replace('sk','')) || 0), 6);
      }
    } catch (err) {
      console.warn('Failed to load saved skills:', err);
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN LISTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function refreshAdminLists() {
  document.getElementById('adminProjList').innerHTML = projects.length
    ? projects.map(p => `<div class="admin-item"><span>${p.icon}</span><span class="ai-name">${esc(p.title)}</span><span class="ai-type">${p.tags.slice(0,3).join(', ')}</span><div class="ai-actions"><button class="ai-edit" onclick="openEditProj('${p.id}')">‚úè Edit</button><button class="ai-del" onclick="deleteProject('${p.id}')">üóë</button></div></div>`).join('')
    : '<p class="empty-note">No custom projects yet.</p>';

  document.getElementById('adminCertList').innerHTML = certs.length
    ? certs.map(c => `<div class="admin-item"><span class="ai-name">${esc(c.name)}</span><span class="ai-type">${esc(c.issuer)}</span>
          <div class="ai-actions">
            <button class="ai-edit" onclick="openEditCert('${c.id}')">‚úè Edit</button>
            <button class="ai-del" onclick="deleteCert('${c.id}')">üóë</button>
          </div>
        </div>`).join('')
    : '<p class="empty-note">No custom certificates yet.</p>';

  document.getElementById('adminSkillList').innerHTML = skills.length
    ? skills.map(s => `<div class="admin-item"><span>${s.icon}</span><span class="ai-name">${esc(s.category)}</span><span class="ai-type">${s.tags.slice(0,3).join(', ')}</span><div class="ai-actions"><button class="ai-edit" onclick="openEditSkill('${s.id}')">‚úè Edit</button><button class="ai-del" onclick="deleteSkill('${s.id}')">üóë</button></div></div>`).join('')
    : '<p class="empty-note">No custom skills yet.</p>';
}

const FALLBACK_PROJECTS = [
  { id:'p-d1', title:'DevSecOps CI/CD Pipeline', icon:'üîê', desc:'End-to-end DevSecOps pipeline automating build, test, scan, package and deployment of a Spring Boot application. SonarQube + Trivy for zero-critical secure delivery on Kubernetes.', tags:['Jenkins','SonarQube','Trivy','Docker','Kubernetes','Prometheus','Grafana'], github:'https://github.com/darshan090905/devsecops-cicd-k8s-pipeline' },
  { id:'p-d2', title:'E-Commerce DevOps Implementation', icon:'üõí', desc:'Full DevOps lifecycle for an e-commerce platform with microservices on AWS EKS provisioned with Terraform. GitOps-based continuous deployment using GitHub Actions and Argo CD.', tags:['AWS EKS','Terraform','GitHub Actions','Argo CD','VPC','Route 53'], github:'https://github.com/darshan090905' },
  { id:'p-d3', title:'GitHub‚ÄìJIRA Automation', icon:'ü§ñ', desc:'Python Flask webhook integration between GitHub and JIRA. Automated ticket creation via REST APIs with duplicate prevention logic to streamline developer issue tracking workflows.', tags:['Python','Flask','GitHub Webhooks','JIRA REST API'], github:'https://github.com/darshan090905' },
];

const FALLBACK_CERTS = [
  { id:'cd1', name:'Cisco Certified Support Technician ‚Äì Cybersecurity', issuer:'Cisco', status:'earned', fileName:null, isImage:false, credentialUrl:'' },
  { id:'cd2', name:'Microsoft Azure Fundamentals AZ-900', issuer:'Microsoft', status:'earned', fileName:null, isImage:false, credentialUrl:'https://www.credly.com/badges/ab71896d-5a81-4db5-9ab1-0590b9a3f3e5' },
  { id:'cd3', name:'IT Specialist ‚Äì Network Security', issuer:'Certiport / Pearson VUE', status:'earned', fileName:null, isImage:false, credentialUrl:'' },
  { id:'cd4', name:'AWS Cloud Practitioner', issuer:'Amazon Web Services', status:'progress', fileName:null, isImage:false, credentialUrl:'' },
];

const FALLBACK_SKILLS = [
  { id:'sk1', icon:'‚òÅ', category:'Cloud & Infrastructure', tags:['AWS EC2','AWS VPC','IAM','AWS EKS','Route 53','Load Balancers','Terraform'] },
  { id:'sk2', icon:'‚öô', category:'CI/CD & Automation', tags:['Jenkins','GitHub Actions','Argo CD','Maven','Nexus','Git / GitHub'] },
  { id:'sk3', icon:'üê≥', category:'Containers & Orchestration', tags:['Docker','Kubernetes','DockerHub','K8s Deployments','K8s Services','Scaling'] },
  { id:'sk4', icon:'üîí', category:'DevSecOps & Quality', tags:['SonarQube','Trivy','Image Scanning','OWASP','Vulnerability Mgmt'] },
  { id:'sk5', icon:'üìä', category:'Monitoring & Observability', tags:['Prometheus','Grafana','Node Exporter','Blackbox Exporter','Alerting'] },
  { id:'sk6', icon:'üíª', category:'Scripting & OS', tags:['Bash','Python','Linux (Ubuntu)','CentOS','Flask','Shell Scripting'] },
];

let DEFAULT_PROJECTS = [...FALLBACK_PROJECTS];
let DEFAULT_CERTS = [...FALLBACK_CERTS];
let DEFAULT_SKILLS = [...FALLBACK_SKILLS];

function stableSeedString(seed) {
  return JSON.stringify({
    projects: seed.projects || [],
    certs: seed.certs || [],
    skills: seed.skills || []
  });
}

function clearSectionStorage() {
  localStorage.removeItem('dp_projects');
  localStorage.removeItem('dp_certs');
  localStorage.removeItem('dp_skills');
}

async function loadSeedDataFromJson() {
  try {
    const res = await fetch('./data.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    return {
      projects: Array.isArray(data.projects) ? data.projects : [],
      certs: Array.isArray(data.certs) ? data.certs : [],
      skills: Array.isArray(data.skills) ? data.skills : []
    };
  } catch (err) {
    console.warn('Could not load data.json, using fallback defaults:', err);
    return {
      projects: [...FALLBACK_PROJECTS],
      certs: [...FALLBACK_CERTS],
      skills: [...FALLBACK_SKILLS]
    };
  }
}

async function initializePortfolioData() {
  const seed = await loadSeedDataFromJson();
  const seedStamp = stableSeedString(seed);
  const savedStamp = localStorage.getItem('dp_data_stamp');
  if (savedStamp !== seedStamp) {
    clearSectionStorage();
    localStorage.setItem('dp_data_stamp', seedStamp);
  }

  DEFAULT_PROJECTS = seed.projects.length ? [...seed.projects] : [...FALLBACK_PROJECTS];
  DEFAULT_CERTS = seed.certs.length ? [...seed.certs] : [...FALLBACK_CERTS];
  DEFAULT_SKILLS = seed.skills.length ? [...seed.skills] : [...FALLBACK_SKILLS];

  projects = [...DEFAULT_PROJECTS];
  certs = [...DEFAULT_CERTS];
  skills = [...DEFAULT_SKILLS];

  projCount = projects.length;
  certCount = certs.length;
  skillCount = skills.length;

  loadProjectsFromStorage();
  loadSkillsFromStorage();
  await loadCertsFromStorage();

  renderProjectsGrid();
  renderCertGrid();
  renderSkillsGrid();
  refreshAdminLists();
}

initializePortfolioData();
</script>
</body>
</html>
